# PythonSQL
My pet DBMS on Python3

###############################################################################
## Документация к СУБД PySQL
###############################################################################

## Вступление
Мой пэт-проект по созданию игрушечной СУБД - PythonSQL =)
Образец для подражания - PostgreSQL, язык - Python 3. Написан с нуля без каких-либо СУБД-библиотек.
Разумеется, это не продуктивная СУБД, ведь я делаю её водиночку на медленном питоне в образовательных целях.
Хочу побыть в шкуре разработчика СУБД и попрактиковаться в python. Наверняка будет полезно и интересно мне самому.

### Условия
Конструктивная критика приветствуется =)
Лицензия - можно использовать мой код как угодно, но желательно указывать имя автора Клыков Леонид.
Пока в планах только один (но это не точно) юзер - pdba. Имя одинаковое в ОС, в БД и у схемы.
Табличные пространства, индексы, WAL, многоверсионность и прочие вещи, связанные с производительностью не будут реализованы.
Структуры памяти и контрольные точки реализовывать не планируется - все изменения сразу на диск.
СУБД исключительно под linux.
Требуется установленный питон 3 какой версии?

Установка СУБД
Пока не понятно, в идеале бы сделать пакет деб
Или хотябы питоновский файл.
При установке должны создаваться:
 1) Служба для СУБД
 2) Пользователь ОС pdba
 2) Каталогом кодов сервера и клиента
 3) Каталог контейнера /var/lib/pythonsql/<container name>
 4) Каталог дефолтной БД (аналог БД postgres) /var/lib/pythonsql/<container name>/db0
 5) Каталог схемы pdba (пустым?)

Запуск СУБД
0) запуск файлом ./PythonSQL_server.py или службой через systemctl
1) СУБД проверяет наличие своего каталога и считает его sha-256 сумму:
/var/lib/pysql/<container name> (ой, а откуда он узнает про контейнер??надо расположить сервер в нём!)
2) СУБД читает файл
/var/lib/pysql/<container name>/<container name>.sha256
3) СУБД сравнивает sha-256 суммы и оповещает о результате.
4) Если в п.1 каталог не найден или суммы не совпадают, СУБД оповещает об этом и предлагает на выбор:
 1 Выключить сервер СУБД
 2 Создать новый контейнер баз банных

Подключение к БД и работа с ней
При подключении клиент pysql напишет версию клиента, сервера, ip сервера.
В момент подключения создаётся объект currentDB.
Так как над другими БД работ производиться не может, то и объекты для них не нужны. Возможность работать в нетекущей БД - несекурно.
SQL команды парсятся при помощи parser.py, который затем вызывает соответствующие функции объекта currentDB.

Расположение файлов
1) "Бинарники" в /opt/PythonSQL/vers/:
  pysql_core  - главный файл сервера
  sql2py.py   - парсинг и выполнение запросов (либо весь серв в одном файле...подумать)
  pysql       - клиент
  pysql_init  - создать новый контейнер баз
  pysql_ctl   - запуск, останов сервера
2) Служба сервера PythonSQL:
/usr/lib/systemd/system/pythonsql.service
3) Данные БД
Каждая таблица является отдельным файлом .csv, расположенным по пути:
/var/lib/pysql/<container name>/<db name>/<schema name>/<table name>.py
Где имена БД, схем, таблиц в виде слитного понятных слов буквами, а не oid как в ПГ.
В недефолтных БД схема pdba автоматом не создаётся.


------------------- Change log ------------------------------------------------

V0.10 - 2025-02-04
  Клиент
Фактически переписан целиком. Создал оболочку PYSQL_SHELL в виде класса и вписал туда всё.
Работает история как в psql! Стрелки вверх, вниз, ^R, хранение в файле .pysql_history
Добавлена обработка ошибки ConnectionRefusedError
  Сервер
Вынесены функции исполнения в отдельный файл. Осталось вынести парсер.


V0.09 - 2025-02-04
Клиент
Теперь не отправляет пустые сообщения на сервер, красивое поведение как в psql.
Сервер
Готов сразу реюзать порт после погашения себя.
Переписал парсер и убрал устаревший конфликтующий с ним интерпретатор.
Добавил функции exit() и kill().
Причесал код.

V0.08 - 2025-02-02
Добавил зачаток парсера команд в виде функции в главном файле сервера.

...

V0.01 - 2025-01-31
Возникла с утра такая идея - сделать свою СУБД =)))
pysql_v0.01.py              самый первый код, который прислал Gigachat
PythonSQL_server_v0.01.py   самый первый код, который прислал Gigachat
Далее я тестировал сервер и клиент и улучшал функционал. Через 1-2 дня на версии 0.07 было решено сохраняться здесь в Github.
